{"createdAt":"2021-05-05T11:43:11.761","modifiedAt":"2021-07-28T16:24:10.368","createdBy":"anonymousUser","modifiedBy":"TAS","title":"SE - Payment List Commands","provider":"SpringBackendServiceProvider","tags":[],"systemTags":["services-editor","published-as-datasource","RESERVED_DOCUMENT"],"name":"SE - Payment List Commands","type":"services-editor","saved":true,"id":"acc85485-58e3-d1aa-0904-c96a18baaa67","previewId":null,"content":{"definition":{"id":"acc85485-58e3-d1aa-0904-c96a18baaa67","title":"SE - Payment List Commands","useBaseUrl":true,"publishAsDatasource":true,"serverSideDatasource":false,"dataEntryEnabled":false,"downloadEnabled":false,"expectedResultType":"Table","validated":false,"mandatoryParameters":[],"skipOnEmptyQueryString":false,"includeRawData":false,"emptyParametersToEmptyString":false,"schema":[{"name":"command","type":"string","value":"authoriseToBo"},{"name":"enabled","type":"boolean","value":false}],"selectCall":{"method":"Get","enabled":true,"serverSide":false,"serverSideUrlParametersEncoded":false,"serverSideUseCallerHeaders":false,"virtual":false,"responseType":"json","transformerOut":{"schema":{},"expectedResult":null,"syntax":"standard","code":"{}"},"transformerIn":{"schema":{"datasource":{},"parameter":{},"systemParameter":{},"custom":{"result":{"fields":[null]}}},"expectedResult":null,"syntax":"standard","code":"var result = toArray(custom('result'));\nvar enabled = _.map(result, function(i){\n\t\n\tvar reconcilePaymentEnabled = false;\n \tvar modifyReconciliationEnabled = true;\n  \tvar authoriseEnabled = false;\n  \tvar rejectEnabled = false;\n  \tvar unblockEnabled = false;\n  \tvar releaseToBoEnabled = false;\n \tvar authoriseToBoEnabled = false;\n    var viewReconciliationEnrichmentEnabled = true;\n    var signOffEnabled = false;\n \tvar rejectInboundEnabled = false;\n  \n\n    if(i.reconciliationStatus === null || i.reconciliationStatus !== 'COMPLETED') {\n    \treconcilePaymentEnabled = true;\n    }\n  \n  \tif((i.forecastPaymentMappingCnt === 0 && i.paymentForecastMappingCnt === 0) && (i.reconciliationStatus === null || i.reconciliationStatus === 'NO')) {\n      modifyReconciliationEnabled = false;\n    }\n  \n  \tif(i.status === 'BLOCKED') {\n      rejectEnabled = true;\n      unblockEnabled = true;\n    }\n  \n  \tif(i.status === 'TO_BE_AUTHORISED') {\n      rejectEnabled = true;\n      authoriseEnabled = true;\n    }\n  \n  \tif(i.codManualReleaseBo === 'MSG_TO_RELEASE') {\n      releaseToBoEnabled = true;\n    }\n  \n  \tif(i.codManualReleaseBo === 'MSG_TO_AUT') {\n      authoriseToBoEnabled = true;\n    }\n  \n  \tif((i.forecastPaymentMappingCnt !== 0 && i.paymentForecastMappingCnt !== 0) && i.reconciliationStatus === null && i.reconciliationStatus === 'NO') {\n      viewReconciliationEnrichmentEnabled = false;\n    }\n    if((i.reconciliationStatus === 'NO' && i.indAccountable === 'Y') && ((i.direction === 'S' && i.status === 'BLOCKED') || (i.direction === 'R' && i.codManualReleaseBo === 'MSG_TO_RELEASE')) )\n    {\n      signOffEnabled = true;\n    }\n  \n  \tif (i.codManualReleaseBo === 'MSG_TO_RELEASE') {\n      releaseToBoEnabled = true;\n      rejectInboundEnabled = true;\n    } else {\n      releaseToBoEnabled = false;\n      rejectInboundEnabled = false;\n    }\n\n  \treturn [{\n      \"command\": \"viewDetail\",\n      \"enabled\": true\n    }, {\n      \"command\": \"viewOriginalMessage\",\n      \"enabled\": true\n    }, {\n      \"command\": \"viewConfirmationMessage\",\n      \"enabled\": true\n    }, {\n      \"command\": \"historyEvents\",\n      \"enabled\": true\n    }, {\n      \"command\": \"reconcilePayment\",\n      \"enabled\": reconcilePaymentEnabled\n    }, {\n      \"command\": \"modifyReconciliation\",\n      \"enabled\": modifyReconciliationEnabled\n    }, {\n      \"command\": \"authorise\",\n      \"enabled\": authoriseEnabled\n    }, {\n      \"command\": \"reject\",\n      \"enabled\": rejectEnabled\n    }, {\n      \"command\": \"unblock\",\n      \"enabled\": unblockEnabled\n    }, {\n      \"command\": \"releaseToBo\",\n      \"enabled\": releaseToBoEnabled\n    }, {\n      \"command\": \"authoriseToBo\",\n      \"enabled\": authoriseToBoEnabled\n    }, {\n      \"command\": \"viewReconciliationEnrichment\",\n      \"enabled\": viewReconciliationEnrichmentEnabled\n    }, {\n      \"command\": \"signOff\",\n      \"enabled\": signOffEnabled\n    }, {\n      \"command\": \"rejectInbound\",\n      \"enabled\": rejectInboundEnabled\n    }];\n\n})\n\nreturn _.flatten(enabled)"},"headers":[],"address":{"schema":{"datasource":{},"parameter":{"id":{"id":"c76a9572-a839-e93f-b859-c23d12523276"}},"systemParameter":{},"custom":{}},"expectedResult":null,"syntax":"web-template","code":"foundation/rs/monitorcashcb/<%= parameter('id') %>"},"type":"Select","errorBypass":{"schema":{},"expectedResult":null,"syntax":"standard"}},"insertCall":{"method":"Put","enabled":false,"serverSide":false,"serverSideUrlParametersEncoded":false,"serverSideUseCallerHeaders":false,"virtual":false,"responseType":"json","transformerOut":{"schema":{},"expectedResult":null,"syntax":"standard","code":"{}"},"transformerIn":{"schema":{},"expectedResult":null,"syntax":"standard","code":"custom('result');"},"headers":[],"address":{"schema":{},"expectedResult":null,"syntax":"web-template"},"type":"Insert","errorBypass":{"schema":{},"expectedResult":null,"syntax":"standard"}},"updateCall":{"method":"Post","enabled":false,"serverSide":false,"serverSideUrlParametersEncoded":false,"serverSideUseCallerHeaders":false,"virtual":false,"responseType":"json","transformerOut":{"schema":{},"expectedResult":null,"syntax":"standard","code":"{}"},"transformerIn":{"schema":{},"expectedResult":null,"syntax":"standard","code":"custom('result');"},"headers":[],"address":{"schema":{},"expectedResult":null,"syntax":"web-template"},"type":"Update","errorBypass":{"schema":{},"expectedResult":null,"syntax":"standard"}},"deleteCall":{"method":"Delete","enabled":false,"serverSide":false,"serverSideUrlParametersEncoded":false,"serverSideUseCallerHeaders":false,"virtual":false,"responseType":"json","transformerOut":{"schema":{},"expectedResult":null,"syntax":"standard","code":"{}"},"transformerIn":{"schema":{},"expectedResult":null,"syntax":"standard","code":"custom('result');"},"headers":[],"address":{"schema":{},"expectedResult":null,"syntax":"web-template"},"type":"Delete","errorBypass":{"schema":{},"expectedResult":null,"syntax":"standard"}},"createCall":{"method":"Get","enabled":false,"serverSide":false,"serverSideUrlParametersEncoded":false,"serverSideUseCallerHeaders":false,"virtual":false,"responseType":"json","transformerOut":{"schema":{},"expectedResult":null,"syntax":"standard","code":"{}"},"transformerIn":{"schema":{},"expectedResult":null,"syntax":"standard","code":"custom('result');"},"headers":[],"address":{"schema":{},"expectedResult":null,"syntax":"web-template"},"type":"Create","errorBypass":{"schema":{},"expectedResult":null,"syntax":"standard"}},"serverSideOptions":{"id":"4a993c15-6ad4-e55b-575b-6e6f614c214e","columns":[],"rows":[],"originalRows":[],"dataEntryRunTypes":[],"datasourceType":"Standard","autoRefreshEnabled":false,"autoRefreshSystem":false,"autoRefreshTime":60,"refreshOnLoad":false,"remoteSort":"","page":1,"isBusy":false,"isFiltered":false,"isServerSide":false,"hasError":false,"splitItems":[],"rowCount":100,"pageSize":10,"tags":[],"parameters":[]},"pageExp":{"schema":{"datasource":{},"parameter":{},"systemParameter":{},"custom":{"result":{"fields":[null]}}},"expectedResult":null,"syntax":"standard","code":"(custom('result')||{}).page||1;"},"pageSizeExp":{"schema":{"datasource":{},"parameter":{},"systemParameter":{},"custom":{"pageSize":{"fields":[null]}}},"expectedResult":null,"syntax":"standard","code":"custom('pageSize')"},"recordCountExp":{"schema":{"datasource":{},"parameter":{},"systemParameter":{},"custom":{"result":{"fields":[null]}}},"expectedResult":null,"syntax":"standard","code":"(custom('result')||{}).total||0;\n"},"sortingExp":{"schema":{},"expectedResult":null,"syntax":"standard"},"resultTypes":"Table","downloadExp":{"schema":{},"expectedResult":null,"syntax":"web-template"},"baseUrlId":"Aquarius Services"},"parameters":[{"id":"c76a9572-a839-e93f-b859-c23d12523276","name":"id","description":"","systemType":"","defaultValue":null,"lookupItems":[],"isHidden":false,"isMultiSelect":false,"isReadOnly":false,"isOptional":false,"popupWidth":260,"isSearchAllowed":false,"ravenParameterType":"normal","ravenDatatype":"string","placeholder":"","value":"577565","lookup":{"mode":"standard","showSearchBox":true,"allowSort":true,"recursiveSelection":false,"bindings":[],"columns":[]},"tags":[],"rules":[]}]}}